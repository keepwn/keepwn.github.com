<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="背景 之前买了个树莓派2，闲置了很久，最近正好有NAS需求，就打算拿它装个OpenMediaVault玩玩。\n安装过程不表。\n事实上是在使用过程中，遇到的某个问题比较奇葩，就拿来分享了。\n"><title>Pi2版OMV的Monit连接错误的问题</title>
<link rel=canonical href=/posts/error-connecting-to-the-monit-daemon-in-omv-for-pi2/><link rel=stylesheet href=/scss/style.min.a1b1ba438e860c87798b68a93abe1acc0cbdab582cb899c9f3bf2afa7be8e373.css><meta property='og:title' content="Pi2版OMV的Monit连接错误的问题"><meta property='og:description' content="背景 之前买了个树莓派2，闲置了很久，最近正好有NAS需求，就打算拿它装个OpenMediaVault玩玩。\n安装过程不表。\n事实上是在使用过程中，遇到的某个问题比较奇葩，就拿来分享了。\n"><meta property='og:url' content='/posts/error-connecting-to-the-monit-daemon-in-omv-for-pi2/'><meta property='og:site_name' content="KeePwn's Notes"><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='raspberrypi omv monit ntp'><meta property='article:tag' content='raspberrypi'><meta property='article:tag' content='omv'><meta property='article:tag' content='monit'><meta property='article:tag' content='ntp'><meta property='article:published_time' content='2015-12-17T00:00:00+00:00'><meta property='article:modified_time' content='2024-10-16T15:41:27+00:00'><meta name=twitter:title content="Pi2版OMV的Monit连接错误的问题"><meta name=twitter:description content="背景 之前买了个树莓派2，闲置了很久，最近正好有NAS需求，就打算拿它装个OpenMediaVault玩玩。\n安装过程不表。\n事实上是在使用过程中，遇到的某个问题比较奇葩，就拿来分享了。\n"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu6864098431101011839.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🚀</span></figure><div class=site-meta><h1 class=site-name><a href=/>KeePwn's Notes</a></h1><h2 class=site-description>我叫王安全，找我最安全</h2></div></header><ol class=menu-social><li><a href=https://github.com/keepwn target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-sun-high" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14.828 14.828A4 4 0 109.172 9.172a4 4 0 005.656 5.656z"/><path d="M6.343 17.657l-1.414 1.414"/><path d="M6.343 6.343 4.929 4.929"/><path d="M17.657 6.343l1.414-1.414"/><path d="M17.657 17.657l1.414 1.414"/><path d="M4 12H2"/><path d="M12 4V2"/><path d="M20 12h2"/><path d="M12 20v2"/></svg>
<svg class="icon icon-tabler icon-tabler-moon-stars" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/><path d="M17 4a2 2 0 002 2 2 2 0 00-2 2 2 2 0 00-2-2 2 2 0 002-2"/><path d="M19 11h2m-1-1v2"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#背景>背景</a></li><li><a href=#林尽水源>林尽水源</a></li><li><a href=#初仿佛若有光>初仿佛若有光</a></li><li><a href=#复行数十步>复行数十步</a></li><li><a href=#豁然开朗>豁然开朗</a></li><li><a href=#参考>参考</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/homelab/ style=background-color:#2a9d8f;color:#fff>HomeLab</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/error-connecting-to-the-monit-daemon-in-omv-for-pi2/>Pi2版OMV的Monit连接错误的问题</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2015/12/17</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>3 minute read</time></div></footer></div></header><section class=article-content><h2 id=背景>背景</h2><p>之前买了个树莓派2，闲置了很久，最近正好有NAS需求，就打算拿它装个<code>OpenMediaVault</code>玩玩。</p><p>安装过程不表。</p><p>事实上是在使用过程中，遇到的某个问题比较奇葩，就拿来分享了。</p><h2 id=林尽水源>林尽水源</h2><p>在网页端对OMV进行配置时，经常会遇到一个弹窗<code>monit: Cannot connect to the monit daemon. Did you start it with http support?</code>。</p><p>详细错误代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>exception</span> <span class=s1>&#39;OMVException&#39;</span> <span class=n>with</span> <span class=n>message</span> <span class=s1>&#39;Failed to execute command &#39;</span><span class=k>export</span> <span class=n>LANG</span><span class=o>=</span><span class=n>C</span><span class=p>;</span> <span class=n>monit</span> <span class=n>restart</span> <span class=n>collectd</span> <span class=mi>2</span><span class=o>&gt;&amp;</span><span class=mi>1</span><span class=s1>&#39;: monit: Cannot connect to the monit daemon. Did you start it with http support?&#39;</span> <span class=ow>in</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>php</span><span class=o>/</span><span class=n>openmediavault</span><span class=o>/</span><span class=n>monit</span><span class=o>.</span><span class=n>inc</span><span class=p>:</span><span class=mi>113</span>
</span></span><span class=line><span class=cl><span class=n>Stack</span> <span class=n>trace</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=c1>#0 /usr/share/php/openmediavault/monit.inc(70): OMVMonit-&gt;action(&#39;restart&#39;, &#39;collectd&#39;, false)</span>
</span></span><span class=line><span class=cl><span class=c1>#1 /usr/share/openmediavault/engined/module/collectd.inc(53): OMVMonit-&gt;restart(&#39;collectd&#39;)</span>
</span></span><span class=line><span class=cl><span class=c1>#2 /usr/share/openmediavault/engined/rpc/config.inc(206): OMVModuleCollectd-&gt;startService()</span>
</span></span><span class=line><span class=cl><span class=c1>#3 [internal function]: OMVRpcServiceConfig-&gt;applyChanges(Array, Array)</span>
</span></span><span class=line><span class=cl><span class=c1>#4 /usr/share/php/openmediavault/rpcservice.inc(125): call_user_func_array(Array, Array)</span>
</span></span><span class=line><span class=cl><span class=c1>#5 /usr/share/php/openmediavault/rpcservice.inc(158): OMVRpcServiceAbstract-&gt;callMethod(&#39;applyChanges&#39;, Array, Array)</span>
</span></span><span class=line><span class=cl><span class=c1>#6 /usr/share/openmediavault/engined/rpc/config.inc(224): OMVRpcServiceAbstract-&gt;callMethodBg(&#39;applyChanges&#39;, Array, Array)</span>
</span></span><span class=line><span class=cl><span class=c1>#7 [internal function]: OMVRpcServiceConfig-&gt;applyChangesBg(Array, Array)</span>
</span></span><span class=line><span class=cl><span class=c1>#8 /usr/share/php/openmediavault/rpcservice.inc(125): call_user_func_array(Array, Array)</span>
</span></span><span class=line><span class=cl><span class=c1>#9 /usr/share/php/openmediavault/rpc.inc(79): OMVRpcServiceAbstract-&gt;callMethod(&#39;applyChangesBg&#39;, Array, Array)</span>
</span></span><span class=line><span class=cl><span class=c1>#10 /usr/sbin/omv-engined(500): OMVRpc::exec(&#39;Config&#39;, &#39;applyChangesBg&#39;, Array, Array, 1)</span>
</span></span><span class=line><span class=cl><span class=c1>#11 {main}</span>
</span></span></code></pre></td></tr></table></div></div><p>ssh到<code>OMV</code>终端，输入命令：<code>monit status</code>，似乎错误信息也一样：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>monit: error connecting to the monit daemon
</span></span></code></pre></td></tr></table></div></div><p>在这种情况下，<code>OMV</code>就无法应用配置，必须解决这问题。</p><h2 id=初仿佛若有光>初仿佛若有光</h2><p>于是去google上找啊，找啊，终于找到一篇帖子，遇到了<a class=link href=http://forums.openmediavault.org/index.php/Thread/8973-Failed-to-execute-command-export-LANG-C-monit-restart-collectd-2-1-monit/ title="Failed to execute command 'export LANG=C; monit restart collectd 2>&amp;1': monit" target=_blank rel=noopener>相似的问题</a>（竟然不是StackOverflow，差评！)</p><div class="admonition quote"><div class="details-summary admonition-title"><i class='icon fas fa-quote-right fa-fw'></i>
Quote</div><div class=details-content><div class=admonition-content><p>Because ntpdate is installed in the image. Both ntp server and ntpdate cannot be installed at the same time. Also, the config for the ntp server does not work&mldr;.</p><p>apt-get &ndash;purge remove ntpdate</p><p>Then in the OMV web gui set your timezone because after these changes you cannot set it again.</p><p>then edit /etc/ntp.conf:</p><p>remove these lines:
server 127.127.1.0 # Local clock
fudge 127.127.1.0 stratum 12
server pool.ntp.org iburst</p><p>And replace with these:
server 0.no.pool.ntp.org iburst
server 1.no.pool.ntp.org iburst
server 2.no.pool.ntp.org iburst
server 3.no.pool.ntp.org iburst</p><p>Then you can:
service ntp restart</p><p>Do not disable/enable in the OMV web gui again. The mkconf file for the ntp service will overwrite thesechanges. There need to be some updates so it works properly with the rpi 2.</p><p>Your logs files and dates at boot will be all messed up with wrong dates until you install a RTC module. After boot it takes some minutes before the ntp server will update the time/date. With a RTC module everything is perfect at boot.</p></div></div></div><p>总结几点就是：</p><ul><li><code>Monit</code>的错误和系统时间有关<ul><li>（检查了一下，确实系统当前时间错误）</li></ul></li><li><code>ntpdate</code>与<code>ntp server</code>有冲突，不能同时安装<ul><li>（检查了一下，ntp服务启动失败）</li></ul></li><li><code>OMV</code>自带的ntp配置<code>/etc/ntp.conf</code>有错误</li><li>你应该安装<code>RTC</code>模块</li></ul><h2 id=复行数十步>复行数十步</h2><p>按照前面这位贤者的建议，我分别进行了一下几个测试：</p><ul><li>测试一: 手动修改当前时间，卸载<code>ntpdate</code>，关闭<code>ntp</code>服务<ul><li>重启以后，时间丢失</li></ul></li><li>测试二: 卸载<code>ntpdate</code>，不修改<code>ntp</code>配置文件<ul><li><code>ntp</code>服务正常启动，时间同步正确</li><li>重启以后，<code>ntp</code>服务正常启动，时间无法同步</li></ul></li><li>测试三: 卸载<code>ntpdate</code>，修改<code>ntp</code>配置文件<ul><li><code>ntp</code>服务正常启动，时间同步正确</li><li>重启以后，<code>ntp</code>服务正常启动，时间无法同步</li></ul></li><li>测试四: 运行<code>ntpdate</code>，强制同步<ul><li>时间同步正确</li><li>重启以后，<code>ntp</code>服务不能正常启动，时间无法同步</li></ul></li></ul><p>测试后发现，因为树莓派本身的硬件限制，系统重启后会丢失当前时间。</p><p>尽管开启了<code>ntp</code>服务，但是如果系统当前时间与真实时间跨度太大，则不会进行同步。</p><p>所以只能放弃<code>ntp server</code>，转而使用<code>ntpdate</code>来强制同步时间，并设置开机启动。</p><p>代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 设置开机同步时间，注意: 添加的代码必须在`exit 0`之前
</span></span><span class=line><span class=cl>echo &#39;/usr/sbin/ntpdate 0.cn.pool.ntp.org&#39; &gt;&gt; /etc/rc.local
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 设置同步任务，每隔5分钟同步一次时间
</span></span><span class=line><span class=cl># 编辑crontab，并保存
</span></span><span class=line><span class=cl>crontab -e
</span></span><span class=line><span class=cl>*/5 * * * * /usr/sbin/ntpdate 0.cn.pool.ntp.org
</span></span></code></pre></td></tr></table></div></div><p>重启系统，系统时间已经正确了。</p><p>在网页端对<code>OMV</code>重新进行配置。WTF，怎么还是<code>monit</code>这个问题！</p><h2 id=豁然开朗>豁然开朗</h2><p>登入终端，重新进行检查：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@raspberrypi:~# date
</span></span><span class=line><span class=cl>Dec <span class=m>16</span> 11:12:04 CST <span class=m>2015</span>
</span></span><span class=line><span class=cl>root@raspberrypi:~# monit status
</span></span><span class=line><span class=cl>monit: error connecting to the monit daemon
</span></span></code></pre></td></tr></table></div></div><p>到这里时，我当时确实很疑惑，明明系统时间已经正确了，为什么<code>monit</code>还是报错呢。</p><p>突然灵光乍现，重新启动<code>monit</code>服务，然后十几秒过后：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@raspberrypi:~# monit status
</span></span><span class=line><span class=cl>The Monit daemon 5.4 uptime: 18m 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>System <span class=s1>&#39;localhost&#39;</span>
</span></span><span class=line><span class=cl>  status                            Running
</span></span><span class=line><span class=cl>  monitoring status                 Monitored
</span></span><span class=line><span class=cl>  load average                      <span class=o>[</span>0.00<span class=o>]</span> <span class=o>[</span>0.01<span class=o>]</span> <span class=o>[</span>0.05<span class=o>]</span>
</span></span><span class=line><span class=cl>  cpu                               0.0%us 0.1%sy 0.0%wa
</span></span><span class=line><span class=cl>  memory usage                      <span class=m>55424</span> kB <span class=o>[</span>5.5%<span class=o>]</span>
</span></span><span class=line><span class=cl>  swap usage                        <span class=m>0</span> kB <span class=o>[</span>0.0%<span class=o>]</span>
</span></span><span class=line><span class=cl>  data collected                    <span class=m>16</span> Dec <span class=m>2015</span> 11:12:17
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Process <span class=s1>&#39;collectd&#39;</span>
</span></span><span class=line><span class=cl>  status                            Running
</span></span><span class=line><span class=cl>  monitoring status                 Monitored
</span></span><span class=line><span class=cl>  pid                               <span class=m>2535</span>
</span></span><span class=line><span class=cl>  parent pid                        <span class=m>1</span>
</span></span><span class=line><span class=cl>  uptime                            18m 
</span></span><span class=line><span class=cl>  children                          <span class=m>0</span>
</span></span><span class=line><span class=cl>  memory kilobytes                  <span class=m>4224</span>
</span></span><span class=line><span class=cl>  memory kilobytes total            <span class=m>4224</span>
</span></span><span class=line><span class=cl>  memory percent                    0.4%
</span></span><span class=line><span class=cl>  memory percent total              0.4%
</span></span><span class=line><span class=cl>  cpu percent                       0.0%
</span></span><span class=line><span class=cl>  cpu percent total                 0.0%
</span></span><span class=line><span class=cl>  data collected                    <span class=m>16</span> Dec <span class=m>2015</span> 11:12:17
</span></span></code></pre></td></tr></table></div></div><p>在此个人分析，在<code>monit</code>服务启动时，系统时间还未同步，所以<code>monit</code>初始化失败。只要保证在时间同步后，再重启<code>monit</code>服务应该就可以了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 在强制同步时间后，再重启monit服务
</span></span><span class=line><span class=cl>echo &#39;/etc/init.d/monit restart&#39; &gt;&gt; /etc/rc.local
</span></span></code></pre></td></tr></table></div></div><p>重启系统，一切正常。END！</p><h2 id=参考>参考</h2><ul><li><a class=link href=http://forums.openmediavault.org/index.php/Thread/8973-Failed-to-execute-command-export-LANG-C-monit-restart-collectd-2-1-monit/ target=_blank rel=noopener>http://forums.openmediavault.org/index.php/Thread/8973-Failed-to-execute-command-export-LANG-C-monit-restart-collectd-2-1-monit/</a></li><li><a class=link href=http://forums.openmediavault.org/index.php/Thread/8770-RPi-2-RTC-module-from-unruly-Stepchild-to-Wunderkind/ target=_blank rel=noopener>http://forums.openmediavault.org/index.php/Thread/8770-RPi-2-RTC-module-from-unruly-Stepchild-to-Wunderkind/</a></li><li><a class=link href="https://www.raspberrypi.org/forums/viewtopic.php?f=91&amp;t=83344" target=_blank rel=noopener>https://www.raspberrypi.org/forums/viewtopic.php?f=91&t=83344</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/raspberrypi-omv-monit-ntp/>Raspberrypi Omv Monit Ntp</a>
<a href=/tags/raspberrypi/>Raspberrypi</a>
<a href=/tags/omv/>Omv</a>
<a href=/tags/monit/>Monit</a>
<a href=/tags/ntp/>Ntp</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on 2024/10/16</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/build-home-cloud-center-for-it/><div class=article-image><img src=/images/banner-build-home-cloud-center-for-IT.png loading=lazy data-key=build-home-cloud-center-for-IT data-hash=/images/banner-build-home-cloud-center-for-IT.png></div><div class=article-details><h2 class=article-title>构建适合程序员的私有云</h2></div></a></article><article><a href=/posts/see-the-big-world-on-openwrt/><div class=article-details><h2 class=article-title>Openwrt上实现透明代理</h2></div></a></article><article><a href=/posts/crossflashing-the-fujitsu-d2607/><div class=article-details><h2 class=article-title>富士通D2607-A11刷IT模式</h2></div></a></article><article><a href=/posts/moving-hyperv-to-esxi/><div class=article-details><h2 class=article-title>从Hyper-V迁移到ESXI的血泪史</h2></div></a></article><article><a href=/posts/route-traffic-selectively-by-domain-on-openwrt/><div class=article-details><h2 class=article-title>Openwrt上使用dnsmasq和ipset实现域名分流</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=keepwn/blog-comments issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2014 -
2024 KeePwn's Notes</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.27.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>